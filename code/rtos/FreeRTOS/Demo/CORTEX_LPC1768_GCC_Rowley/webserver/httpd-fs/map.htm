<head>
<script>
function doAjaxGet(url, callback){
	var ajaxRequest;  // The variable that makes Ajax possible!
	
	try{
		// Opera 8.0+, Firefox, Safari
		ajaxRequest = new XMLHttpRequest();
	} catch (e){
		// Internet Explorer Browsers
		try{
			ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
		} catch (e) {
			try{
				ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
			} catch (e){
				// Something went wrong
				alert("Your browser broke!");
				return false;
			}
		}
	}
	ajaxRequest.responseType = 'arraybuffer';
	// Create a function that will receive data sent from the server
	ajaxRequest.onreadystatechange = function(){
		if(ajaxRequest.readyState == 4){
			callback(new Uint8Array(ajaxRequest.response));
			//document.getElementById(resultDiv).innerHTML = ajaxRequest.responseText;
		}
	}
	ajaxRequest.open("GET", url, true);
	ajaxRequest.send(null); 
}

var Width = 64;
var tab = [];

function tableCreate(){
	var body=document.getElementsByTagName('body')[0];
	var tbl=document.createElement('table');
	tbl.setAttribute('border','0');
	tbl.setAttribute('cellspacing','0');
	var tbdy=document.createElement('tbody');
	for(var i=0;i<Width;i++){
		 var tr=document.createElement('tr');
		 var rr = [];
		 tab[i] = rr;
		 for(var j=0;j<Width;j++){
			  var td=document.createElement('td');
			  td.style.width = 2;
			  td.style.height = 4;
			  tr.appendChild(td)
			  rr[j] = td;
		 }
		 tbdy.appendChild(tr);
	}
	tbl.appendChild(tbdy);
	body.appendChild(tbl)
			  //i==1&&j==1?td.setAttribute('rowSpan','2'):null;
}

function tableUpdate(data) {
	var n = 4, val = 0;
	var cur = 0;
	for (var i=0; i<Width; i++) {
		for (var j=0;j<Width; j++) {
			if (n == 4) {
				val = data[cur];
				cur++;
				n = 0;
			}
			
			var ch;
			switch ((val >> (n*2)) & 3) {
				case 0: ch = "#FFFFFF"; break;
				case 1: ch = "#CCCCCC"; break;
				case 2: ch = "#000000"; break;
				case 3: ch = "#FF0000"; break;
			}
			tab[j][i].style.background = ch;
			n++
		}
	}
	info = document.getElementById('info');
	var to = "(X, Y) = (" + data[cur] + ", " + data[cur+1] + ")<br>"
	var lap1 = data[cur+2];
	if (lap1 > 0) {
		to += "Lap 1: " + lap1 + "<br>";
	}
	var lap2 = data[cur+3];
	if (lap2 > 0) {
		to += "Lap 2: " + lap2 + "<br>";
	}
	
	info.innerHTML = to;
	tab[data[cur+1]][data[cur]].style.background = "#0000FF";
}
</script>
<style>
*{font-family:"Lucida Console", Monaco, monospace;}
</style>
</head>
<body>
<div id=info />
<script>
tableCreate();
doAjaxGet("/map.bin",tableUpdate);
setInterval(function(){doAjaxGet("/map.bin",tableUpdate)}, 2000);
</script>
</body>

